{"ast":null,"code":"import _regeneratorRuntime from \"D:\\\\C#\\\\blackjack_WebAPI - Copy\\\\front-end\\\\node_modules\\\\@babel\\\\runtime/regenerator\";\nimport _asyncToGenerator from \"D:\\\\C#\\\\blackjack_WebAPI - Copy\\\\front-end\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";\nimport _assertThisInitialized from \"D:\\\\C#\\\\blackjack_WebAPI - Copy\\\\front-end\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/assertThisInitialized\";\nimport _classCallCheck from \"D:\\\\C#\\\\blackjack_WebAPI - Copy\\\\front-end\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"D:\\\\C#\\\\blackjack_WebAPI - Copy\\\\front-end\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"D:\\\\C#\\\\blackjack_WebAPI - Copy\\\\front-end\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"D:\\\\C#\\\\blackjack_WebAPI - Copy\\\\front-end\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"D:\\\\C#\\\\blackjack_WebAPI - Copy\\\\front-end\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"D:\\\\C#\\\\blackjack_WebAPI - Copy\\\\front-end\\\\src\\\\containers\\\\Profile\\\\Profile.js\";\nimport React, { Component } from 'react';\nimport classes from './Profile.css';\nimport { NavLink, Redirect } from 'react-router-dom';\nimport Button from '../../components/UI/Button/Button';\nimport axios from 'axios'; //import $ from 'jquery';\n\nimport StartConnection, { connection, playHubProxy } from '../../Hubs/Hubs'; //import { hubConnection } from 'signalr-no-jquery';\n\nvar renderOutput = [];\nvar setCount = 0;\n\nvar Popup =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(Popup, _React$Component);\n\n  function Popup() {\n    _classCallCheck(this, Popup);\n\n    return _possibleConstructorReturn(this, _getPrototypeOf(Popup).apply(this, arguments));\n  }\n\n  _createClass(Popup, [{\n    key: \"render\",\n    value: function render() {\n      return React.createElement(\"div\", {\n        className: classes.popup,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 18\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: classes.popup_inner,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 19\n        },\n        __self: this\n      }, React.createElement(\"h1\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 20\n        },\n        __self: this\n      }, this.props.text), React.createElement(\"button\", {\n        onClick: this.props.closePopup,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 21\n        },\n        __self: this\n      }, \"close me\")));\n    }\n  }]);\n\n  return Popup;\n}(React.Component);\n\nvar Profile =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Profile, _Component);\n\n  function Profile() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, Profile);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(Profile)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    _this.state = {\n      isLogout: false,\n      bet: '',\n      name: '',\n      email: '',\n      count: 0\n    };\n\n    _this.UsersList = function (props) {\n      renderOutput = [];\n\n      for (var i = 0; i < props.length; i++) {\n        if (props[i].id === localStorage.getItem('userId')) {\n          renderOutput.push(React.createElement(\"b\", {\n            key: props[i].id,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 41\n            },\n            __self: this\n          }, \" \", props[i].name, \" \"));\n        } else {\n          console.log(props.ready);\n          renderOutput.push(React.createElement(\"div\", {\n            key: props[i].id,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 45\n            },\n            __self: this\n          }, props[i].name, props.ready ? \"<button id={props.id} onClick={this.offerGame.bind(this)}>Играть</button>\" : null));\n        }\n      }\n    };\n\n    _this.NewUser = function (props) {\n      console.log(props.ready);\n      renderOutput.push(React.createElement(\"div\", {\n        key: props.id,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 55\n        },\n        __self: this\n      }, props.name, props.ready ? \"<button id={props.id} onClick={this.offerGame.bind(this)}>Играть</button>\" : null));\n    };\n\n    _this.UserDisconnect = function (props) {\n      for (var i = 0; i < renderOutput.length; i++) {\n        if (renderOutput[i].key === props.id) {\n          renderOutput.splice(i, 1);\n        }\n      }\n    };\n\n    _this.UserReady = function (props) {\n      console.log(props.ready);\n\n      for (var i = 0; i < renderOutput.length; i++) {\n        if (renderOutput[i].key === props.id) {\n          renderOutput[i] = React.createElement(\"div\", {\n            key: props.id,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 72\n            },\n            __self: this\n          }, props.name, props.ready ? React.createElement(\"button\", {\n            id: props.id,\n            onClick: _this.offerGame.bind(_assertThisInitialized(_assertThisInitialized(_this))),\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 74\n            },\n            __self: this\n          }, \"\\u0418\\u0433\\u0440\\u0430\\u0442\\u044C\") : null);\n        }\n      }\n    };\n\n    _this.togglePopup = function () {\n      _this.setState({\n        showPopup: !_this.state.showPopup\n      });\n    };\n\n    _this.isLogout = function () {\n      localStorage.removeItem('userId');\n      localStorage.removeItem('enemyId');\n      localStorage.removeItem('ready');\n\n      _this.setState({\n        isLogout: true\n      });\n\n      console.log('Disconnected');\n      connection.stop();\n    };\n\n    _this.getDataUser =\n    /*#__PURE__*/\n    function () {\n      var _ref = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee(userId) {\n        var data, respons;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                data = {\n                  userId: userId\n                };\n                _context.next = 3;\n                return axios.post('http://localhost:3001/profile', data);\n\n              case 3:\n                respons = _context.sent;\n\n                if (respons.data) {\n                  _this.setState({\n                    isLogout: false,\n                    bet: respons.data.bet,\n                    name: respons.data.name,\n                    email: respons.data.email\n                  });\n\n                  localStorage.setItem('ready', false);\n                } else _this.setState({\n                  isLogout: true\n                });\n\n              case 5:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }();\n\n    _this.offerGame = function (e) {\n      localStorage.setItem(\"enemyId\", e.target.id);\n      console.log(e.currentTarget.id);\n      console.log(\"offer enemy\");\n      playHubProxy.invoke(\"offerGame\", localStorage.getItem('userId'), e.currentTarget.id);\n    };\n\n    _this.readyState = function () {\n      localStorage.setItem('ready', !localStorage.getItem('ready'));\n      playHubProxy.invoke(\"ready\", localStorage.getItem('userId'));\n    };\n\n    return _this;\n  }\n\n  _createClass(Profile, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var userId = localStorage.getItem('userId');\n      this.getDataUser(userId);\n\n      function sss() {\n        this.setState({\n          count: setCount\n        });\n      }\n\n      ;\n      sss = sss.bind(this);\n      playHubProxy.on('onConnected', function (profiles) {\n        console.log('Connected');\n        this.UsersList(profiles);\n        setCount = profiles.length;\n        sss();\n      }.bind(this));\n      playHubProxy.on('onNewUserConnected', function (newUser) {\n        console.log('New user');\n        setCount++;\n        this.NewUser(newUser);\n        sss();\n      }.bind(this));\n      playHubProxy.on('onUserDisconnected', function (profile) {\n        if (connection != null) {\n          console.log('User disconnected');\n          setCount--;\n          this.UserDisconnect(profile);\n          sss();\n        }\n      }.bind(this));\n\n      if (connection.state === 4) {\n        /*connection.start().done(function(){\n            playHubProxy.invoke('connect', userId);\n            console.log(userId);\n        });*/\n        StartConnection(userId);\n      } else {\n        sss();\n      }\n\n      playHubProxy.on('onUserReady', function (profile) {\n        console.log('user ready');\n        this.UserReady(profile);\n        sss();\n      }.bind(this));\n      playHubProxy.on('onGameOffer', function (profile) {\n        console.log('enemy');\n        console.log(profile);\n        this.togglePopup();\n      }.bind(this));\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      playHubProxy.off('onConnected');\n      playHubProxy.off('onNewUserConnected');\n      playHubProxy.off('onUserDisconnected');\n      playHubProxy.off('onUserReady');\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      if (this.state.isLogout) {\n        return React.createElement(Redirect, {\n          to: \"/\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 189\n          },\n          __self: this\n        });\n      } else {\n        return React.createElement(\"div\", {\n          className: classes.Profile,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 192\n          },\n          __self: this\n        }, React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 193\n          },\n          __self: this\n        }, React.createElement(\"h1\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 194\n          },\n          __self: this\n        }, this.state.name), React.createElement(\"hr\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 195\n          },\n          __self: this\n        }), React.createElement(\"p\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 196\n          },\n          __self: this\n        }, React.createElement(\"b\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 197\n          },\n          __self: this\n        }, \"\\u041F\\u043E\\u0447\\u0442\\u0430: \"), React.createElement(\"em\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 197\n          },\n          __self: this\n        }, this.state.email), React.createElement(\"br\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 197\n          },\n          __self: this\n        }), React.createElement(\"b\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 198\n          },\n          __self: this\n        }, \"\\u0421\\u0447\\u0435\\u0442: \"), React.createElement(\"em\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 198\n          },\n          __self: this\n        }, this.state.bet), React.createElement(\"br\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 198\n          },\n          __self: this\n        })), React.createElement(\"hr\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 200\n          },\n          __self: this\n        }), React.createElement(\"div\", {\n          className: classes.Buttons,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 201\n          },\n          __self: this\n        }, React.createElement(\"span\", {\n          onClick: this.readyState,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 202\n          },\n          __self: this\n        }, React.createElement(Button, {\n          type: localStorage.getItem('ready') ? \"notReady\" : \"success\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 203\n          },\n          __self: this\n        }, localStorage.getItem('ready') ? \"Не готов\" : \"Готов\")), React.createElement(\"span\", {\n          id: \"disconnect\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 205\n          },\n          __self: this\n        }, React.createElement(Button, {\n          type: \"error\",\n          onClick: this.isLogout,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 205\n          },\n          __self: this\n        }, \"\\u0412\\u044B\\u0445\\u043E\\u0434\"))), React.createElement(\"hr\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 210\n          },\n          __self: this\n        }), React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 211\n          },\n          __self: this\n        }, \"Users online: \", this.state.count, React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 213\n          },\n          __self: this\n        }, renderOutput))));\n      }\n    }\n  }]);\n\n  return Profile;\n}(Component);\n\nexport default Profile;","map":{"version":3,"sources":["D:\\C#\\blackjack_WebAPI - Copy\\front-end\\src\\containers\\Profile\\Profile.js"],"names":["React","Component","classes","NavLink","Redirect","Button","axios","StartConnection","connection","playHubProxy","renderOutput","setCount","Popup","popup","popup_inner","props","text","closePopup","Profile","state","isLogout","bet","name","email","count","UsersList","i","length","id","localStorage","getItem","push","console","log","ready","NewUser","UserDisconnect","key","splice","UserReady","offerGame","bind","togglePopup","setState","showPopup","removeItem","stop","getDataUser","userId","data","post","respons","setItem","e","target","currentTarget","invoke","readyState","sss","on","profiles","newUser","profile","off","Buttons"],"mappings":"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","sourcesContent":["import React, {Component} from 'react'\nimport classes from './Profile.css'\nimport {NavLink, Redirect} from 'react-router-dom'\nimport Button from '../../components/UI/Button/Button'\nimport axios from 'axios';\n\n//import $ from 'jquery';\nimport StartConnection, {connection, playHubProxy} from '../../Hubs/Hubs'\n//import { hubConnection } from 'signalr-no-jquery';\n\nvar renderOutput = [];\n\nvar setCount = 0;\n\nclass Popup extends React.Component {\n    render() {\n        return (\n            <div className={classes.popup}>\n                <div className={classes.popup_inner}>\n                    <h1>{this.props.text}</h1>\n                    <button onClick={this.props.closePopup}>close me</button>\n                </div>\n            </div>\n        );\n    }\n}\n\nclass Profile extends Component{\n    state = {\n        isLogout: false,\n        bet: '',\n        name: '',\n        email: '',\n        count: 0\n    }\n\n    UsersList = (props) =>{\n        renderOutput = [];\n        for( var i = 0; i < props.length; i++ ){\n            if(props[i].id === localStorage.getItem('userId')){\n                renderOutput.push(<b key = {props[i].id} > {props[i].name} </b>);\n            } else {\n                console.log(props.ready);\n                renderOutput.push(\n                    <div key = {props[i].id} > \n                        {props[i].name} \n                        {props.ready ? \"<button id={props.id} onClick={this.offerGame.bind(this)}>Играть</button>\" : null}\n                    </div>);\n            }\n        }\n    }\n    NewUser = (props) =>{\n        console.log(props.ready);\n        renderOutput.push(\n            <div key = {props.id} > \n                {props.name} \n                {props.ready ? \"<button id={props.id} onClick={this.offerGame.bind(this)}>Играть</button>\" : null}\n            </div>);\n    }\n    UserDisconnect = (props) =>{\n        for( var i = 0; i < renderOutput.length; i++){ \n            if ( renderOutput[i].key === props.id ) {\n                renderOutput.splice(i, 1); \n            }\n        }\n    }\n    UserReady = (props) =>{\n        console.log(props.ready);\n        for( var i = 0; i < renderOutput.length; i++){ \n            if ( renderOutput[i].key === props.id ) {\n                renderOutput[i] = \n                    <div key = {props.id} > \n                        {props.name} \n                        {props.ready ? <button id={props.id} onClick={this.offerGame.bind(this)}>Играть</button> : null}\n                    </div>; \n            }\n        }\n    }\n\n    togglePopup = () => {\n        this.setState({\n            showPopup: !this.state.showPopup\n        });\n    }\n\n    isLogout = () => {\n        localStorage.removeItem('userId');\n        localStorage.removeItem('enemyId');\n        localStorage.removeItem('ready');\n        this.setState({\n            isLogout: true\n        });        \n        console.log('Disconnected');\n        connection.stop();\n    }\n\n    componentDidMount(){\n        const userId = localStorage.getItem('userId');\n        this.getDataUser(userId);\n\n        function sss(){\n            this.setState({\n                count: setCount\n            });\n        };\n        sss = sss.bind(this);\n\n        playHubProxy.on('onConnected', function(profiles){\n            console.log('Connected')\n            this.UsersList(profiles);\n            setCount = profiles.length;\n            sss();\n        }.bind(this));\n\n        playHubProxy.on('onNewUserConnected', function(newUser){\n            console.log('New user')\n            setCount++;\n            this.NewUser(newUser);\n            sss();\n        }.bind(this));\n        playHubProxy.on('onUserDisconnected', function(profile){\n            if(connection != null){\n                console.log('User disconnected')\n                setCount--;\n                this.UserDisconnect(profile);\n                sss();\n            }\n        }.bind(this));\n        if(connection.state === 4){\n            /*connection.start().done(function(){\n                playHubProxy.invoke('connect', userId);\n                console.log(userId);\n            });*/\n            StartConnection(userId);\n        } else {\n            sss();\n        }\n\n        playHubProxy.on('onUserReady', function(profile){\n            console.log('user ready');\n            this.UserReady(profile);\n            sss()\n        }.bind(this));\n\n        playHubProxy.on('onGameOffer', function(profile){\n            console.log('enemy');\n            console.log(profile);\n            this.togglePopup();\n        }.bind(this));\n    }\n\n    componentWillUnmount(){\n        playHubProxy.off('onConnected');\n        playHubProxy.off('onNewUserConnected');\n        playHubProxy.off('onUserDisconnected');\n        playHubProxy.off('onUserReady');\n    }\n\n    getDataUser = async (userId)=>{\n        const data = {\n            userId: userId  \n        }\n        const respons = await axios.post('http://localhost:3001/profile', data);\n        if(respons.data){\n            this.setState({\n                isLogout: false,\n                bet: respons.data.bet,\n                name: respons.data.name,\n                email: respons.data.email\n            });\n            localStorage.setItem('ready', false);\n        } else this.setState({isLogout: true});\n    }\n\n    offerGame = (e) => {\n        localStorage.setItem(\"enemyId\", e.target.id);\n        console.log(e.currentTarget.id);\n        console.log(\"offer enemy\");\n        playHubProxy.invoke(\"offerGame\", localStorage.getItem('userId'), e.currentTarget.id);\n    }\n\n    readyState = () => {\n        localStorage.setItem('ready', !localStorage.getItem('ready'));\n        playHubProxy.invoke(\"ready\", localStorage.getItem('userId'));\n    }\n\n    render(){\n        if(this.state.isLogout){\n            return (<Redirect to='/' />)\n        }else{\n            return(\n                <div className={classes.Profile}>\n                    <div>\n                        <h1>{this.state.name}</h1>\n                        <hr />\n                        <p>\n                            <b>Почта: </b><em>{this.state.email}</em><br />\n                            <b>Счет: </b><em>{this.state.bet}</em><br />\n                        </p>\n                        <hr />\n                        <div className={classes.Buttons}>\n                            <span onClick={this.readyState}>\n                                <Button type={localStorage.getItem('ready') ? \"notReady\" : \"success\"} >{localStorage.getItem('ready') ? \"Не готов\" : \"Готов\"}</Button>\n                            </span>\n                            <span id=\"disconnect\"><Button\n                                type=\"error\"\n                                onClick={this.isLogout} \n                            >Выход</Button></span>  \n                        </div>\n                        <hr />\n                        <div>\n                            Users online: {this.state.count}\n                            <div>                                \n                                {renderOutput}\n                            </div>\n                        </div>                         \n                    </div>\n                </div>\n            )   \n        }\n             \n    }\n}\n\nexport default Profile"]},"metadata":{},"sourceType":"module"}