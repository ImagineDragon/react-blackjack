{"ast":null,"code":"import _regeneratorRuntime from \"D:\\\\C#\\\\blackjack_WebAPI - Copy\\\\front-end\\\\node_modules\\\\@babel\\\\runtime/regenerator\";\nimport _asyncToGenerator from \"D:\\\\C#\\\\blackjack_WebAPI - Copy\\\\front-end\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"D:\\\\C#\\\\blackjack_WebAPI - Copy\\\\front-end\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"D:\\\\C#\\\\blackjack_WebAPI - Copy\\\\front-end\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"D:\\\\C#\\\\blackjack_WebAPI - Copy\\\\front-end\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"D:\\\\C#\\\\blackjack_WebAPI - Copy\\\\front-end\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"D:\\\\C#\\\\blackjack_WebAPI - Copy\\\\front-end\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"D:\\\\C#\\\\blackjack_WebAPI - Copy\\\\front-end\\\\src\\\\containers\\\\Profile\\\\Profile.js\";\nimport React, { Component } from 'react';\nimport classes from './Profile.css';\nimport { NavLink, Redirect } from 'react-router-dom';\nimport Button from '../../components/UI/Button/Button';\nimport axios from 'axios';\nimport $ from 'jquery'; //import StartConnection, {connection, playHubProxy} from '../../Hubs/Hubs'\n\nimport { hubConnection } from 'signalr-no-jquery';\nvar connection = hubConnection('http://localhost:3001');\nvar playHubProxy = connection.createHubProxy('playHub');\nvar renderOutput = [];\n\nfunction UsersList(props) {\n  renderOutput = [];\n\n  for (var i = 0; i < props.length; i++) {\n    if (props[i].id === localStorage.getItem('userId')) {\n      renderOutput.push(React.createElement(\"b\", {\n        key: props[i].id,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 19\n        },\n        __self: this\n      }, \" \", props[i].name, \" \"));\n    } else {\n      renderOutput.push(React.createElement(\"div\", {\n        key: props[i].id,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 21\n        },\n        __self: this\n      }, \" \", props[i].name, \" \", React.createElement(\"button\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 21\n        },\n        __self: this\n      }, \"\\u0418\\u0433\\u0440\\u0430\\u0442\\u044C\"), \" \"));\n    }\n  }\n\n  console.log(\"output\");\n  console.log(renderOutput);\n}\n\nfunction NewUser(props) {\n  renderOutput.push(React.createElement(\"div\", {\n    key: props.id,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 28\n    },\n    __self: this\n  }, \" \", props.name, \" \", React.createElement(\"button\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 28\n    },\n    __self: this\n  }, \"\\u0418\\u0433\\u0440\\u0430\\u0442\\u044C\"), \" \"));\n  console.log(\"output\");\n  console.log(renderOutput);\n}\n\nfunction UserDisconnect(props) {\n  for (var i = 0; i < renderOutput.length; i++) {\n    if (renderOutput[i].key === props.id) {\n      renderOutput.splice(i, 1);\n    }\n  }\n\n  console.log(\"output\");\n  console.log(renderOutput);\n}\n\nvar setCount = 0;\n\nvar Profile =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Profile, _Component);\n\n  function Profile() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, Profile);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(Profile)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    _this.state = {\n      isLogout: false,\n      bet: '',\n      name: '',\n      email: '',\n      count: 0\n    };\n\n    _this.isLogout = function () {\n      localStorage.removeItem('userId');\n\n      _this.setState({\n        isLogout: true\n      });\n\n      console.log('stop');\n      connection.stop();\n    };\n\n    _this.getDataUser =\n    /*#__PURE__*/\n    function () {\n      var _ref = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee(userId) {\n        var data, respons;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                data = {\n                  userId: userId\n                };\n                _context.next = 3;\n                return axios.post('http://localhost:3001/profile', data);\n\n              case 3:\n                respons = _context.sent;\n\n                if (respons.data) {\n                  _this.setState({\n                    isLogout: false,\n                    bet: respons.data.bet,\n                    name: respons.data.name,\n                    email: respons.data.email,\n                    count: setCount\n                  });\n\n                  console.log(_this.state);\n                } else _this.setState({\n                  isLogout: true\n                });\n\n              case 5:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }();\n\n    return _this;\n  }\n\n  _createClass(Profile, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var userId = localStorage.getItem('userId'); //this.getDataUser(userId);\n\n      function sss() {\n        console.log(this.state.name);\n        console.log(this.state.count);\n        /*this.setState({ //--------------Can't call setState on an unmounted component\n            count: setCount\n        });*/\n\n        this.getDataUser(userId);\n        console.log(this.state.count);\n      }\n\n      ;\n      sss = sss.bind(this);\n\n      if (!this.state.isLogout) {\n        playHubProxy.on('onConnected', function (profiles) {\n          console.log('Connected');\n          UsersList(profiles);\n          console.log(profiles);\n          setCount = profiles.length;\n          this.getDataUser(userId); //sss();\n        }.bind(this));\n      }\n\n      playHubProxy.on('onNewUserConnected', function (newUser) {\n        console.log('New user');\n        console.log(newUser);\n        setCount++;\n        NewUser(newUser);\n        sss();\n        console.log(setCount);\n      });\n      playHubProxy.on('onUserDisconnected', function (profile) {\n        console.log('User disconnected');\n        console.log(profile);\n        setCount--;\n        UserDisconnect(profile);\n        sss();\n        console.log(setCount);\n      });\n\n      if (connection.state == 4) {\n        connection.start().done(function () {\n          playHubProxy.invoke('connect', userId);\n          console.log(userId);\n        }); //StartConnection(\"connect\", userId);\n      } else {\n        sss();\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      if (this.state.isLogout) {\n        return React.createElement(Redirect, {\n          to: \"/\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 134\n          },\n          __self: this\n        });\n      } else {\n        return React.createElement(\"div\", {\n          className: classes.Profile,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 137\n          },\n          __self: this\n        }, React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 138\n          },\n          __self: this\n        }, React.createElement(\"h1\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 139\n          },\n          __self: this\n        }, this.state.name), React.createElement(\"hr\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 140\n          },\n          __self: this\n        }), React.createElement(\"p\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 141\n          },\n          __self: this\n        }, React.createElement(\"b\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 142\n          },\n          __self: this\n        }, \"\\u041F\\u043E\\u0447\\u0442\\u0430: \"), React.createElement(\"em\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 142\n          },\n          __self: this\n        }, this.state.email), React.createElement(\"br\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 142\n          },\n          __self: this\n        }), React.createElement(\"b\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 143\n          },\n          __self: this\n        }, \"\\u0421\\u0447\\u0435\\u0442: \"), React.createElement(\"em\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 143\n          },\n          __self: this\n        }, this.state.bet), React.createElement(\"br\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 143\n          },\n          __self: this\n        })), React.createElement(\"hr\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 145\n          },\n          __self: this\n        }), React.createElement(\"div\", {\n          className: classes.Buttons,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 146\n          },\n          __self: this\n        }, React.createElement(NavLink, {\n          to: \"/play\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 147\n          },\n          __self: this\n        }, React.createElement(Button, {\n          type: \"success\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 148\n          },\n          __self: this\n        }, \"\\u0418\\u0433\\u0440\\u0430\\u0442\\u044C\")), React.createElement(\"span\", {\n          id: \"disconnect\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 152\n          },\n          __self: this\n        }, React.createElement(Button, {\n          type: \"error\",\n          onClick: this.isLogout,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 152\n          },\n          __self: this\n        }, \"\\u0412\\u044B\\u0445\\u043E\\u0434\"))), React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 157\n          },\n          __self: this\n        }, \"Users online: \", this.state.count, React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 159\n          },\n          __self: this\n        }, renderOutput))));\n      }\n    }\n  }]);\n\n  return Profile;\n}(Component);\n\nexport default Profile;","map":{"version":3,"sources":["D:\\C#\\blackjack_WebAPI - Copy\\front-end\\src\\containers\\Profile\\Profile.js"],"names":["React","Component","classes","NavLink","Redirect","Button","axios","$","hubConnection","connection","playHubProxy","createHubProxy","renderOutput","UsersList","props","i","length","id","localStorage","getItem","push","name","console","log","NewUser","UserDisconnect","key","splice","setCount","Profile","state","isLogout","bet","email","count","removeItem","setState","stop","getDataUser","userId","data","post","respons","sss","bind","on","profiles","newUser","profile","start","done","invoke","Buttons"],"mappings":"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","sourcesContent":["import React, {Component} from 'react'\nimport classes from './Profile.css'\nimport {NavLink, Redirect} from 'react-router-dom'\nimport Button from '../../components/UI/Button/Button'\nimport axios from 'axios';\n\nimport $ from 'jquery';\n//import StartConnection, {connection, playHubProxy} from '../../Hubs/Hubs'\nimport { hubConnection } from 'signalr-no-jquery';\n\nvar connection = hubConnection('http://localhost:3001');\nvar playHubProxy = connection.createHubProxy('playHub');\n\nvar renderOutput = [];\nfunction UsersList(props) {\n    renderOutput = [];\n    for( var i = 0; i < props.length; i++ ){\n        if(props[i].id === localStorage.getItem('userId')){\n            renderOutput.push(<b key = {props[i].id} > {props[i].name} </b>);\n        } else {\n            renderOutput.push(<div key = {props[i].id} > {props[i].name} <button>Играть</button> </div>);\n        }\n    }\n    console.log(\"output\")\n    console.log(renderOutput);\n}\nfunction NewUser(props) {\n    renderOutput.push(<div key = {props.id} > {props.name} <button>Играть</button> </div>);\n    console.log(\"output\")\n    console.log(renderOutput);\n}\nfunction UserDisconnect (props) {\n    for( var i = 0; i < renderOutput.length; i++){ \n        if ( renderOutput[i].key === props.id ) {\n            renderOutput.splice(i, 1); \n        }\n     }\n    console.log(\"output\")\n    console.log(renderOutput);\n}\n\nvar setCount = 0;\n\nclass Profile extends Component{\n    state = {\n        isLogout: false,\n        bet: '',\n        name: '',\n        email: '',\n        count: 0\n    }\n\n    isLogout = () => {\n        localStorage.removeItem('userId');\n        this.setState({\n            isLogout: true\n        });        \n        console.log('stop');\n        connection.stop();\n    }\n\n    componentDidMount(){\n        const userId = localStorage.getItem('userId');\n        //this.getDataUser(userId);\n\n        function sss(){\n            console.log(this.state.name);\n            console.log(this.state.count);\n            /*this.setState({ //--------------Can't call setState on an unmounted component\n                count: setCount\n            });*/\n            this.getDataUser(userId);\n            console.log(this.state.count);\n        };\n        sss = sss.bind(this);\n\n        if(!this.state.isLogout){\n            playHubProxy.on('onConnected', function(profiles){\n                console.log('Connected')\n                UsersList(profiles);\n                console.log(profiles);\n                setCount = profiles.length;\n                this.getDataUser(userId);\n                //sss();\n            }.bind(this));\n        }\n\n        playHubProxy.on('onNewUserConnected', function(newUser){\n            console.log('New user')\n            console.log(newUser);\n            setCount++;\n            NewUser(newUser);\n            sss();\n            console.log(setCount);\n        });\n        playHubProxy.on('onUserDisconnected', function(profile){\n            console.log('User disconnected')\n            console.log(profile);\n            setCount--;\n            UserDisconnect(profile);\n            sss();\n            console.log(setCount);\n        });\n        if(connection.state == 4){\n            connection.start().done(function(){\n                playHubProxy.invoke('connect', userId);\n                console.log(userId);\n            });\n            //StartConnection(\"connect\", userId);\n        } else {\n            sss();\n        }\n    }\n\n    getDataUser = async (userId)=>{\n        const data = {\n            userId: userId  \n        }\n        const respons = await axios.post('http://localhost:3001/profile', data);\n        if(respons.data){\n            this.setState({\n                isLogout: false,\n                bet: respons.data.bet,\n                name: respons.data.name,\n                email: respons.data.email,\n                count: setCount\n            })\n            console.log(this.state);\n        } else this.setState({isLogout: true});\n    }\n\n    render(){\n        if(this.state.isLogout){\n            return (<Redirect to='/' />)\n        }else{\n            return(\n                <div className={classes.Profile}>\n                    <div>\n                        <h1>{this.state.name}</h1>\n                        <hr />\n                        <p>\n                            <b>Почта: </b><em>{this.state.email}</em><br />\n                            <b>Счет: </b><em>{this.state.bet}</em><br />\n                        </p>\n                        <hr />\n                        <div className={classes.Buttons}>\n                            <NavLink to=\"/play\">\n                                <Button \n                                    type=\"success\" \n                                >Играть</Button>\n                            </NavLink> \n                            <span id=\"disconnect\"><Button\n                                type=\"error\"\n                                onClick={this.isLogout} \n                            >Выход</Button></span>  \n                        </div>  \n                        <div>\n                            Users online: {this.state.count}\n                            <div>                                \n                                {renderOutput}\n                            </div>\n                        </div>                         \n                    </div>        \n                </div>\n            )   \n        }\n             \n    }\n}\n\nexport default Profile"]},"metadata":{},"sourceType":"module"}