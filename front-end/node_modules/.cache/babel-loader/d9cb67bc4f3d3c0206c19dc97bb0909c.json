{"ast":null,"code":"import _classCallCheck from \"D:\\\\C#\\\\react-blackjack\\\\front-end\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"D:\\\\C#\\\\react-blackjack\\\\front-end\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"D:\\\\C#\\\\react-blackjack\\\\front-end\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"D:\\\\C#\\\\react-blackjack\\\\front-end\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"D:\\\\C#\\\\react-blackjack\\\\front-end\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nimport { Component } from 'react';\nimport { history } from '../store/history';\nimport { hubConnection } from 'signalr-no-jquery';\nimport { connect } from 'react-redux';\nimport { scrollDown } from '../components/UI/Chat/Chat';\nimport { onGameStart as _onGameStart, onEnemyBet as _onEnemyBet, onMessage as _onMessage, onTimer as _onTimer, setActivePlayer as _setActivePlayer, onPlayHandler as _onPlayHandler, enemyGetCard as _enemyGetCard, gameResult as _gameResult, gameEnd as _gameEnd } from '../store/actions/playTable';\nexport var connection = hubConnection('http://localhost:3001/'),\n    playHubProxy = connection.createHubProxy('playHub');\n\nvar PlayConnection =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(PlayConnection, _Component);\n\n  function PlayConnection() {\n    _classCallCheck(this, PlayConnection);\n\n    return _possibleConstructorReturn(this, _getPrototypeOf(PlayConnection).apply(this, arguments));\n  }\n\n  _createClass(PlayConnection, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var userId = parseInt(localStorage.getItem('userId'));\n      var enemyId = parseInt(localStorage.getItem('enemyId'));\n      playHubProxy.on('onGameStart', function (user, enemy, messages) {\n        this.props.onGameStart(user, enemy, messages);\n        scrollDown();\n      }.bind(this));\n      playHubProxy.on('onEnemyBet', function (enemy, dibsBet) {\n        this.props.onEnemyBet(enemy.bet, enemy.cash, dibsBet);\n      }.bind(this));\n      playHubProxy.on('onStopGame', function () {\n        history.push('/profile');\n      });\n      playHubProxy.on('onMessage', function (message) {\n        this.props.onMessage(message);\n        scrollDown();\n      }.bind(this));\n      playHubProxy.on('onPlayOffer', function (isBet) {\n        var betCount = this.props.user.betCount;\n\n        if (this.props.user.bet > 0 && isBet) {\n          betCount--;\n        }\n\n        this.props.setActivePlayer(userId, isBet, betCount);\n\n        if (this.props.user.enoughCards) {\n          playHubProxy.invoke('gameResult');\n        } else {\n          if (!isBet && this.props.user.playerHandSum === 0) {\n            this.props.onPlayHandler();\n          }\n        }\n      }.bind(this));\n      playHubProxy.on('onTimer', function (time) {\n        this.props.onTimer(time);\n      }.bind(this));\n      playHubProxy.on('onEnemyGetCard', function () {\n        this.props.enemyGetCard();\n      }.bind(this));\n      playHubProxy.on('onGameResult', function (enemyHand, enemyHandSum) {\n        this.props.gameResult(enemyHand, enemyHandSum);\n      }.bind(this));\n      playHubProxy.on('onGameEnd', function (winnerId) {\n        this.props.gameEnd(winnerId); //history.push('/profile');\n      }.bind(this));\n\n      if (enemyId !== -1) {\n        connection.start({\n          transport: 'serverSentEvents'\n        }).done(function () {\n          playHubProxy.invoke('gameStart', userId);\n        });\n      }\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      playHubProxy.off('onGameStart');\n      playHubProxy.off('onEnemyBet');\n      playHubProxy.off('onBet');\n      playHubProxy.off('onStopGame');\n      playHubProxy.off('onMessage');\n      playHubProxy.off('onPlayOffer');\n      playHubProxy.off('onTimer');\n      playHubProxy.off('onEnemyGetCard');\n      playHubProxy.off('onGameResult');\n      playHubProxy.off('onGameEnd');\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return null;\n    }\n  }]);\n\n  return PlayConnection;\n}(Component);\n\nfunction mapStateToProps(state) {\n  var user = state.playTable.user;\n  return {\n    user: user\n  };\n}\n\nfunction mapDispatchToProps(dispatch) {\n  return {\n    onGameStart: function onGameStart(user, enemy, messages) {\n      return dispatch(_onGameStart(user, enemy, messages));\n    },\n    onMessage: function onMessage(message) {\n      return dispatch(_onMessage(message));\n    },\n    setActivePlayer: function setActivePlayer(id, isBet, betCount) {\n      return dispatch(_setActivePlayer(id, isBet, betCount));\n    },\n    onPlayHandler: function onPlayHandler() {\n      return dispatch(_onPlayHandler());\n    },\n    onEnemyBet: function onEnemyBet(bet, cash, dibsBet) {\n      return dispatch(_onEnemyBet(bet, cash, dibsBet));\n    },\n    onTimer: function onTimer(time) {\n      return dispatch(_onTimer(time));\n    },\n    enemyGetCard: function enemyGetCard() {\n      return dispatch(_enemyGetCard());\n    },\n    gameResult: function gameResult(enemyHand, enemyHandSum) {\n      return dispatch(_gameResult(enemyHand, enemyHandSum));\n    },\n    gameEnd: function gameEnd(winnerId) {\n      return dispatch(_gameEnd(winnerId));\n    }\n  };\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(PlayConnection);","map":{"version":3,"sources":["D:\\C#\\react-blackjack\\front-end\\src\\Hubs\\PlayTableHub.js"],"names":["Component","history","hubConnection","connect","scrollDown","onGameStart","onEnemyBet","onMessage","onTimer","setActivePlayer","onPlayHandler","enemyGetCard","gameResult","gameEnd","connection","playHubProxy","createHubProxy","PlayConnection","userId","parseInt","localStorage","getItem","enemyId","on","user","enemy","messages","props","bind","dibsBet","bet","cash","push","message","isBet","betCount","enoughCards","invoke","playerHandSum","time","enemyHand","enemyHandSum","winnerId","start","transport","done","off","mapStateToProps","state","playTable","mapDispatchToProps","dispatch","id"],"mappings":"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","sourcesContent":["import { Component } from 'react'\r\n\r\nimport { history } from '../store/history'\r\n\r\nimport { hubConnection } from 'signalr-no-jquery';\r\n\r\nimport { connect } from 'react-redux'\r\n\r\nimport { scrollDown } from '../components/UI/Chat/Chat'\r\n\r\nimport { onGameStart,\r\n        onEnemyBet,\r\n        onMessage,\r\n        onTimer,\r\n        setActivePlayer,\r\n        onPlayHandler,\r\n        enemyGetCard,\r\n        gameResult,\r\n        gameEnd } from '../store/actions/playTable'\r\n\r\nexport const connection = hubConnection('http://localhost:3001/'), playHubProxy = connection.createHubProxy('playHub');\r\n\r\nclass PlayConnection extends Component{\r\n    componentDidMount(){\r\n        const userId = parseInt(localStorage.getItem('userId'));\r\n        const enemyId = parseInt(localStorage.getItem('enemyId'));\r\n\r\n        playHubProxy.on('onGameStart', function(user, enemy, messages){\r\n            this.props.onGameStart(user, enemy, messages);\r\n            scrollDown();\r\n        }.bind(this));\r\n\r\n        playHubProxy.on('onEnemyBet', function(enemy, dibsBet){\r\n            this.props.onEnemyBet(enemy.bet, enemy.cash, dibsBet);\r\n        }.bind(this));\r\n\r\n        playHubProxy.on('onStopGame', function(){\r\n            history.push('/profile');\r\n        });\r\n\r\n        playHubProxy.on('onMessage', function(message){\r\n            this.props.onMessage(message);\r\n            scrollDown();\r\n        }.bind(this));\r\n\r\n        playHubProxy.on('onPlayOffer', function(isBet){\r\n            let betCount = this.props.user.betCount;\r\n            if(this.props.user.bet > 0 && isBet){\r\n                betCount--;\r\n            }\r\n            this.props.setActivePlayer(userId, isBet, betCount);\r\n            if(this.props.user.enoughCards){\r\n                playHubProxy.invoke('gameResult');\r\n            } else {\r\n                if(!isBet && this.props.user.playerHandSum === 0) {\r\n                    this.props.onPlayHandler();\r\n                }\r\n            }\r\n        }.bind(this));\r\n\r\n        playHubProxy.on('onTimer', function(time){\r\n            this.props.onTimer(time);\r\n        }.bind(this));\r\n\r\n        playHubProxy.on('onEnemyGetCard', function(){\r\n            this.props.enemyGetCard();\r\n        }.bind(this));\r\n\r\n        playHubProxy.on('onGameResult', function(enemyHand, enemyHandSum){\r\n            this.props.gameResult(enemyHand, enemyHandSum);\r\n        }.bind(this));\r\n\r\n        playHubProxy.on('onGameEnd', function(winnerId){\r\n            this.props.gameEnd(winnerId);            \r\n            //history.push('/profile');\r\n        }.bind(this));\r\n\r\n        if(enemyId !== -1){\r\n            connection.start({ transport: 'serverSentEvents' }).done(function(){\r\n                playHubProxy.invoke('gameStart', userId);\r\n            });\r\n        }\r\n    }\r\n\r\n    componentWillUnmount(){\r\n        playHubProxy.off('onGameStart');\r\n        playHubProxy.off('onEnemyBet');\r\n        playHubProxy.off('onBet');\r\n        playHubProxy.off('onStopGame');\r\n        playHubProxy.off('onMessage');\r\n        playHubProxy.off('onPlayOffer');\r\n        playHubProxy.off('onTimer');\r\n        playHubProxy.off('onEnemyGetCard');\r\n        playHubProxy.off('onGameResult');\r\n        playHubProxy.off('onGameEnd');\r\n    }\r\n\r\n    render(){\r\n        return null;\r\n    }\r\n}\r\n\r\nfunction mapStateToProps(state) {\r\n    const { user } = state.playTable;\r\n    return {\r\n        user\r\n    };\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch){\r\n    return{\r\n        onGameStart: (user, enemy, messages) => dispatch(onGameStart(user, enemy, messages)),\r\n        onMessage: (message) => dispatch(onMessage(message)),\r\n        setActivePlayer: (id, isBet, betCount) => dispatch(setActivePlayer(id, isBet, betCount)),\r\n        onPlayHandler: () => dispatch(onPlayHandler()),\r\n        onEnemyBet: (bet, cash, dibsBet) => dispatch(onEnemyBet(bet, cash, dibsBet)),\r\n        onTimer: (time) => dispatch(onTimer(time)),\r\n        enemyGetCard: () => dispatch(enemyGetCard()),\r\n        gameResult: (enemyHand, enemyHandSum) => dispatch(gameResult(enemyHand, enemyHandSum)),\r\n        gameEnd: (winnerId) => dispatch(gameEnd(winnerId))\r\n    }\r\n}\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(PlayConnection)"]},"metadata":{},"sourceType":"module"}