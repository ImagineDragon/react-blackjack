{"ast":null,"code":"import _regeneratorRuntime from \"D:\\\\C#\\\\blackjack_WebAPI - Copy\\\\front-end\\\\node_modules\\\\@babel\\\\runtime/regenerator\";\nimport _asyncToGenerator from \"D:\\\\C#\\\\blackjack_WebAPI - Copy\\\\front-end\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"D:\\\\C#\\\\blackjack_WebAPI - Copy\\\\front-end\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"D:\\\\C#\\\\blackjack_WebAPI - Copy\\\\front-end\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"D:\\\\C#\\\\blackjack_WebAPI - Copy\\\\front-end\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"D:\\\\C#\\\\blackjack_WebAPI - Copy\\\\front-end\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"D:\\\\C#\\\\blackjack_WebAPI - Copy\\\\front-end\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"D:\\\\C#\\\\blackjack_WebAPI - Copy\\\\front-end\\\\src\\\\containers\\\\Profile\\\\Profile.js\";\nimport React, { Component } from 'react';\nimport classes from './Profile.css';\nimport { NavLink, Redirect } from 'react-router-dom';\nimport Button from '../../components/UI/Button/Button';\nimport axios from 'axios';\nimport Users from '../../components/UI/UsersList/UsersList'; //import $ from 'jquery';\n\nimport StartConnection, { connection, playHubProxy } from '../../Hubs/Hubs'; //import { hubConnection } from 'signalr-no-jquery';\n\nvar setCount = 0;\n\nvar Profile =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Profile, _Component);\n\n  function Profile() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, Profile);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(Profile)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    _this.state = {\n      isLogout: false,\n      bet: '',\n      name: '',\n      email: '',\n      count: 0,\n      ready: false,\n      users: []\n    };\n\n    _this.isLogout = function () {\n      localStorage.removeItem('userId');\n\n      _this.setState({\n        isLogout: true\n      });\n\n      connection.stop();\n      console.log('stop');\n    };\n\n    _this.getDataUser =\n    /*#__PURE__*/\n    function () {\n      var _ref = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee(userId) {\n        var data, respons;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                data = {\n                  userId: userId\n                };\n                _context.next = 3;\n                return axios.post('http://localhost:3001/profile', data);\n\n              case 3:\n                respons = _context.sent;\n\n                if (respons.data) {\n                  _this.setState({\n                    isLogout: false,\n                    bet: respons.data.bet,\n                    name: respons.data.name,\n                    email: respons.data.email\n                  });\n                } else _this.setState({\n                  isLogout: true\n                });\n\n              case 5:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }();\n\n    _this.acceptGame = function (e) {\n      localStorage.setItem(\"enemyId\", e.target.id);\n\n      if (_this.state.ready) {\n        _this.readyState();\n      }\n\n      playHubProxy.invoke(\"acceptGame\", localStorage.getItem('userId'), localStorage.getItem(\"enemyId\")); //connection.stop();\n\n      _this.props.history.push('/play');\n    };\n\n    _this.playWithBot = function () {\n      if (_this.state.ready) {\n        _this.readyState();\n      }\n\n      _this.props.history.push('/play');\n    };\n\n    _this.readyState = function () {\n      playHubProxy.invoke(\"ready\", localStorage.getItem('userId'), !_this.state.ready);\n\n      _this.setState({\n        ready: !_this.state.ready\n      });\n    };\n\n    return _this;\n  }\n\n  _createClass(Profile, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      localStorage.removeItem('playerHand');\n      localStorage.removeItem('dealerHand');\n      localStorage.removeItem('playerHandSum');\n      localStorage.removeItem('dealerHandSum');\n      localStorage.removeItem('bet');\n      localStorage.removeItem('cash');\n      localStorage.removeItem('dibsBet');\n      localStorage.removeItem('enemyDibsBet');\n      localStorage.removeItem('timer');\n      localStorage.removeItem('name');\n      localStorage.setItem('enemyId', -1);\n      var userId = localStorage.getItem('userId');\n      this.getDataUser(userId);\n      playHubProxy.on('onConnected', function (profiles) {\n        console.log('Connected');\n        setCount = profiles.length;\n        this.setState({\n          users: profiles,\n          count: setCount\n        });\n      }.bind(this));\n      playHubProxy.on('onNewUserConnected', function (newUser) {\n        console.log('New user');\n        var users = this.state.users;\n        var index = users.indexOf(newUser);\n\n        if (index == -1) {\n          users.push(newUser);\n          setCount++;\n        }\n\n        this.setState({\n          users: users,\n          count: setCount\n        });\n      }.bind(this));\n      playHubProxy.on('onUserDisconnected', function (profile) {\n        if (connection != null) {\n          console.log('User disconnected');\n          setCount--;\n          var users = this.state.users;\n\n          for (var i = 0; i < users.length; i++) {\n            if (users[i].id === profile.id) {\n              users.splice(i, 1);\n              break;\n            }\n          }\n\n          this.setState({\n            users: users,\n            count: setCount\n          });\n        }\n      }.bind(this));\n\n      if (connection.state === 4) {\n        StartConnection(userId);\n      }\n\n      playHubProxy.on('onUserReady', function (profile) {\n        var users = this.state.users;\n\n        for (var i = 0; i < users.length; i++) {\n          if (users[i].id === profile.id) {\n            users[i] = profile;\n            break;\n          }\n        }\n\n        console.log(users);\n        this.setState({\n          users: users,\n          count: setCount\n        });\n      }.bind(this));\n      playHubProxy.on('onGameAccept', function (profile) {\n        localStorage.setItem('enemyId', profile.id);\n        this.readyState(); //connection.stop();\n\n        this.props.history.push('/play');\n      }.bind(this));\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      playHubProxy.off('onConnected');\n      playHubProxy.off('onNewUserConnected');\n      playHubProxy.off('onUserDisconnected');\n      playHubProxy.off('onUserReady');\n      playHubProxy.off('onGameAccept');\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      if (this.state.isLogout) {\n        return React.createElement(Redirect, {\n          to: \"/\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 169\n          },\n          __self: this\n        });\n      } else {\n        return React.createElement(\"div\", {\n          className: classes.Profile,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 172\n          },\n          __self: this\n        }, React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 173\n          },\n          __self: this\n        }, React.createElement(\"h1\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 174\n          },\n          __self: this\n        }, this.state.name), React.createElement(\"hr\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 175\n          },\n          __self: this\n        }), React.createElement(\"p\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 176\n          },\n          __self: this\n        }, React.createElement(\"b\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 177\n          },\n          __self: this\n        }, \"\\u041F\\u043E\\u0447\\u0442\\u0430: \"), React.createElement(\"em\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 177\n          },\n          __self: this\n        }, this.state.email), React.createElement(\"br\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 177\n          },\n          __self: this\n        }), React.createElement(\"b\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 178\n          },\n          __self: this\n        }, \"\\u0421\\u0447\\u0435\\u0442: \"), React.createElement(\"em\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 178\n          },\n          __self: this\n        }, this.state.bet), React.createElement(\"br\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 178\n          },\n          __self: this\n        })), React.createElement(\"hr\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 180\n          },\n          __self: this\n        }), React.createElement(\"div\", {\n          className: classes.Buttons,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 181\n          },\n          __self: this\n        }, React.createElement(Button, {\n          type: \"success\",\n          onClick: this.playWithBot,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 182\n          },\n          __self: this\n        }, \"\\u0418\\u0433\\u0440\\u0430\\u0442\\u044C \\u0441 \\u0431\\u043E\\u0442\\u043E\\u043C\"), React.createElement(Button, {\n          type: this.state.ready ? \"notReady\" : \"success\",\n          onClick: this.readyState,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 186\n          },\n          __self: this\n        }, this.state.ready ? \"Не готов\" : \"Готов\"), React.createElement(Button, {\n          type: \"error\",\n          onClick: this.isLogout,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 190\n          },\n          __self: this\n        }, \"\\u0412\\u044B\\u0445\\u043E\\u0434\")), React.createElement(\"hr\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 195\n          },\n          __self: this\n        }), React.createElement(Users, {\n          Count: this.state.count,\n          onClick: this.acceptGame,\n          Users: this.state.users,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 196\n          },\n          __self: this\n        })));\n      }\n    }\n  }]);\n\n  return Profile;\n}(Component);\n\nexport default Profile;","map":{"version":3,"sources":["D:\\C#\\blackjack_WebAPI - Copy\\front-end\\src\\containers\\Profile\\Profile.js"],"names":["React","Component","classes","NavLink","Redirect","Button","axios","Users","StartConnection","connection","playHubProxy","setCount","Profile","state","isLogout","bet","name","email","count","ready","users","localStorage","removeItem","setState","stop","console","log","getDataUser","userId","data","post","respons","acceptGame","e","setItem","target","id","readyState","invoke","getItem","props","history","push","playWithBot","on","profiles","length","bind","newUser","index","indexOf","profile","i","splice","off","Buttons"],"mappings":"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","sourcesContent":["import React, {Component} from 'react'\nimport classes from './Profile.css'\nimport {NavLink, Redirect} from 'react-router-dom'\nimport Button from '../../components/UI/Button/Button'\nimport axios from 'axios';\n\nimport Users from '../../components/UI/UsersList/UsersList'\n\n//import $ from 'jquery';\nimport StartConnection, {connection, playHubProxy} from '../../Hubs/Hubs'\n//import { hubConnection } from 'signalr-no-jquery';\n\nvar setCount = 0;\n\nclass Profile extends Component{\n    state = {\n        isLogout: false,\n        bet: '',\n        name: '',\n        email: '',\n        count: 0,\n        ready: false,\n        users: []\n    }\n\n    isLogout = () => {\n        localStorage.removeItem('userId');\n        this.setState({\n            isLogout: true\n        });\n        connection.stop();\n        console.log('stop');\n    }\n\n    componentDidMount(){\n        localStorage.removeItem('playerHand');\n        localStorage.removeItem('dealerHand');\n        localStorage.removeItem('playerHandSum');\n        localStorage.removeItem('dealerHandSum');\n\n        localStorage.removeItem('bet');\n        localStorage.removeItem('cash');\n        localStorage.removeItem('dibsBet');\n        localStorage.removeItem('enemyDibsBet');\n        localStorage.removeItem('timer');\n        localStorage.removeItem('name');\n\n        localStorage.setItem('enemyId', -1);\n        const userId = localStorage.getItem('userId');\n        this.getDataUser(userId);\n\n        playHubProxy.on('onConnected', function(profiles){\n            console.log('Connected');\n            setCount = profiles.length;\n            this.setState({\n                users: profiles,\n                count: setCount\n            });\n        }.bind(this));\n\n        playHubProxy.on('onNewUserConnected', function(newUser){\n            console.log('New user')\n            var users = this.state.users;\n            var index = users.indexOf(newUser);\n            if(index == -1){\n                users.push(newUser);\n                setCount++;\n            }\n            this.setState({\n                users: users,\n                count: setCount\n            });\n        }.bind(this));\n\n        playHubProxy.on('onUserDisconnected', function(profile){\n            if(connection != null){\n                console.log('User disconnected')\n                setCount--;\n                var users = this.state.users;\n                for(var i = 0; i < users.length; i++){\n                    if(users[i].id === profile.id){\n                        users.splice(i, 1);\n                        break;\n                    }\n                }     \n                this.setState({\n                    users: users,\n                    count: setCount\n                });\n            }\n        }.bind(this));\n\n        if(connection.state === 4){\n            StartConnection(userId);\n        }\n\n        playHubProxy.on('onUserReady', function(profile){\n            var users = this.state.users;\n            for(var i = 0; i < users.length; i++){\n                if(users[i].id === profile.id){\n                    users[i] = profile;\n                    break;\n                }\n            }            \n            console.log(users);\n            this.setState({\n                users: users,\n                count: setCount\n            });\n        }.bind(this));\n\n        playHubProxy.on('onGameAccept', function(profile){\n            localStorage.setItem('enemyId', profile.id);\n            this.readyState();\n            //connection.stop();\n            this.props.history.push('/play');\n        }.bind(this));\n    }\n\n    componentWillUnmount(){\n        playHubProxy.off('onConnected');\n        playHubProxy.off('onNewUserConnected');\n        playHubProxy.off('onUserDisconnected');\n        playHubProxy.off('onUserReady');\n        playHubProxy.off('onGameAccept');\n    }\n\n    getDataUser = async (userId)=>{\n        const data = {\n            userId: userId  \n        }\n        const respons = await axios.post('http://localhost:3001/profile', data);\n        if(respons.data){\n            this.setState({\n                isLogout: false,\n                bet: respons.data.bet,\n                name: respons.data.name,\n                email: respons.data.email\n            })\n        } else this.setState({isLogout: true});\n    }\n\n    acceptGame = (e) => {\n        localStorage.setItem(\"enemyId\", e.target.id);\n        if(this.state.ready){\n            this.readyState();\n        }\n        playHubProxy.invoke(\"acceptGame\", localStorage.getItem('userId'), localStorage.getItem(\"enemyId\"));\n        //connection.stop();\n        this.props.history.push('/play');\n    }\n\n    playWithBot = () => {\n        if(this.state.ready){\n            this.readyState();\n        }\n        this.props.history.push('/play');\n    }\n\n    readyState = () => {\n        playHubProxy.invoke(\"ready\", localStorage.getItem('userId'), !this.state.ready);\n        this.setState({\n            ready: !this.state.ready\n        });\n    }\n\n    render(){\n        if(this.state.isLogout){\n            return (<Redirect to='/' />)\n        }else{\n            return(\n                <div className={classes.Profile}>\n                    <div>\n                        <h1>{this.state.name}</h1>\n                        <hr />\n                        <p>\n                            <b>Почта: </b><em>{this.state.email}</em><br />\n                            <b>Счет: </b><em>{this.state.bet}</em><br />\n                        </p>\n                        <hr />\n                        <div className={classes.Buttons}>\n                            <Button\n                                type=\"success\" \n                                onClick={this.playWithBot} \n                            >Играть с ботом</Button>\n                            <Button \n                                type={this.state.ready ? \"notReady\" : \"success\"} \n                                onClick={this.readyState} \n                            >{this.state.ready ? \"Не готов\" : \"Готов\"}</Button>\n                            <Button\n                                type=\"error\"\n                                onClick={this.isLogout} \n                            >Выход</Button>\n                        </div>\n                        <hr />\n                        <Users\n                            Count={this.state.count}\n                            onClick={this.acceptGame}\n                            Users={this.state.users}\n                        />\n                    </div>\n                </div>\n            )   \n        }\n             \n    }\n}\n\nexport default Profile"]},"metadata":{},"sourceType":"module"}